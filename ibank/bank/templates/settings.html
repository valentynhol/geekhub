{% extends 'base.html' %}

{% block page_title %}Налаштування{% endblock %}

{% block style %}
            #name:hover, #lastname:hover, #patronymic:hover, #new_password1:hover, #new_password2:hover, #current_password:hover{
                border: 2px solid black;
                border-radius: 7px;
            }

            #name, #lastname, #patronymic {
                border: 1px solid grey;
                border-radius: 7px;
                height: 40px;
                width: 100%;
                padding: 8px;
            }

            .password-container input {
                border: 1px solid grey;
                border-radius: 7px;
                height: 40px;
                padding: 8px;
                flex: 1 1 auto;
            }

            .password-container {
                width: 100%;
            }

            form{
                min-width: 230px;
                max-width: 300px;
                width: 25%;
            }

            label{
                font-size: 0.75rem;
            }

            #resetPasswordLink::before{
                content: '';
                background-color: #000;
                transition: 0.3s ease-in-out;
                position: absolute;
                left: 0;
                bottom: 0;
                width: 100%;
                height: 2px;
                z-index: -1;
            }

            #resetPasswordLink {
                text-decoration: none;
                transition: 0.3s ease-in-out;
                color: #212529;
                position: relative;
                display: inline-block;
            }

            #resetPasswordLink:hover{
                color: #f8f9fa;
                cursor: pointer;
            }

            #resetPasswordLink:hover::before{
                height: 100%;
            }

            .switch {
                position: relative;
                display: inline-block;
                width: 60px;
                height: 34px;
            }

            .switch input {
                display: none;
            }

            .slider {
                position: absolute;
                cursor: pointer;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background-color: #ccc;
                -webkit-transition: .4s;
                transition: .4s;
            }

            .slider::before {
                position: absolute;
                content: "";
                height: 26px;
                width: 26px;
                left: 4px;
                bottom: 4px;
                background-color: white;
                -webkit-transition: .4s;
                transition: .4s;
            }

            input:checked + .slider {
                background-color: #212529;
            }

            input:focus + .slider {
                box-shadow: 0 0 1px #2196F3;
            }

            input:checked + .slider::before {
                -webkit-transform: translateX(26px);
                -ms-transform: translateX(26px);
                transform: translateX(26px);
            }

            .slider.round {
                border-radius: 34px;
            }

            .slider.round::before {
                border-radius: 50%;
            }
{% endblock %}

{% block page %}
<h1 class="border-bottom">Акаунт</h1>
<div class="row row-cols-1 row-cols-md-2">
    <div>
        <h3 class="text-center pt-4">Особиста інформація</h3>
        <form action="" method="post" class="mx-auto">
            {% csrf_token %}
            <input type="hidden" name="type" value="personal_info">
            <label for="name" class="text-disabled">Ім'я</label>
            <input type="text" name="name" id="name" value="{{ name }}" class="mb-2">
            <label for="lastname" class="text-disabled">Прізвище</label>
            <input type="text" name="lastname" id="lastname" value="{{ last_name }}" class="mb-2">
            <label for="patronymic" class="text-disabled">По-батькові</label>
            <input type="text" name="patronymic" id="patronymic" value="{{ patronymic }}" class="mb-2">
            <input type="submit" value="Змінити" style="height: 40px; display: block; margin-left: auto" class="btn btn-success mt-3 shadow">
        </form>
    </div>
    <div>
        <h3 class="text-center pt-4">Зміна паролю</h3>
        <form action="" method="post" class="mx-auto mb-4">
            {% csrf_token %}
            <input type="hidden" name="type" value="change_password">
            <label for="currentPassword" class="text-disabled">Старий пароль</label>
            <div class="input-group row row-cols-2 flex-nowrap mb-2 m-0 password-container">
                <input type="password" name="current_password" id="currentPassword">
                <button class="btn btn-outline-dark col-auto" type="button" onclick="showPassword('currentPassword', this.id)" id="currentPasswordBtn"><i class="bi-eye-fill"></i></button>
            </div>
            <label for="newPassword1" class="text-disabled">Новий пароль</label>
            <div class="input-group row row-cols-2 flex-nowrap mb-2 m-0 password-container">
                <input type="password" name="new_password1" id="newPassword1">
                <button class="btn btn-outline-dark col-auto" type="button" onclick="showPassword('newPassword1', this.id)" id="newPassword1btn"><i class="bi-eye-fill"></i></button>
            </div>
            <label for="newPassword2" class="text-disabled">Новий пароль (ще раз)</label>
            <div class="input-group row row-cols-2 flex-nowrap mb-2 m-0 password-container">
                <input class="" type="password" name="new_password2" id="newPassword2">
                <button class="btn btn-outline-dark col-auto" type="button" onclick="showPassword('newPassword2', this.id)" id="newPassword2btn"><i class="bi-eye-fill"></i></button>
            </div>
            <input type="submit" value="Змінити" style="height: 40px; display: block; margin-left: auto" class="btn btn-success mt-3 shadow">
        </form>
        <p class="text-center" id="resetPassword">Я не пам'ятаю пароль. <a onclick="sendResetMsg()" id="resetPasswordLink"><strong class="m-1">Скинути</strong></a></p>
    </div>
</div>

    <div class="my-4">
        <div class="row flex-nowrap border-bottom w-100 m-0">
            <h1 class="col">Двоетапний вхід</h1>
            <div class="col-auto d-flex m-auto">
                <label class="switch">
                    <input type="checkbox" oninput="update2stepLogin(this)" {% if 2_step_login %}checked{% endif %}>
                    <span class="slider round"></span>
                </label>
            </div>
        </div>
    </div>


    <div class="toast-container position-fixed top-0 mt-3 start-50 translate-middle-x" style="z-index: 3">
        <div id="reset_password" class="toast bg-dark bg-gradient text-light" role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="5000" style="--bs-bg-opacity: .9">
        <div class="toast-body">
            <p class="m-auto text-center">На вашу електронну адресу було надіслано посилання для скидання пароля</p>
        </div>
        </div>
    </div>
{% endblock %}
{% block script %}
    <script>
        function update2stepLogin(checkInput) {
            $.ajax({
                url: '',

                data: {
                    'type': '2_step_login',
                    'value': checkInput.checked,
                },

                headers: {
                    'X-CSRFToken': '{{ csrf_token }}',
                },

                method: 'POST'
            })
        }

        function sendResetMsg() {
            document.getElementById('resetPassword').remove()
            $.ajax({
                url: '',

                data: {
                    'type': 'reset_password',
                },

                headers: {
                    'X-CSRFToken': '{{ csrf_token }}',
                },

                method: 'POST'
            }).done(function (data, textStatus, jqXHR) {
                const toast = new bootstrap.Toast(document.getElementById('reset_password'));
                toast.show();
            })
        }

        function showPassword(inputId, buttonId) {
            document.getElementById(inputId).setAttribute('type', 'text');
            let btn = document.getElementById(buttonId);
            btn.setAttribute('onclick', 'hidePassword("' + inputId + '", this.id)');
            btn.innerHTML = '<i class="bi-eye-slash-fill"></i>';
        }

        function hidePassword(inputId, buttonId) {
            document.getElementById(inputId).setAttribute('type', 'password');
            let btn = document.getElementById(buttonId);
            btn.setAttribute('onclick', 'showPassword("' + inputId + '", this.id)');
            btn.innerHTML = '<i class="bi-eye-fill"></i>';
        }
    </script>
{% endblock %}